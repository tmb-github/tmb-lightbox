/** * tmbLightbox.js * Copyright (c) 2019-2024 Thomas M. Brodhead <https://bmt-systems.com> * Released under the GNU GPLv3 License * Date: 2024-02-06 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(f){var e=0;return function(){return e<f.length?{done:!1,value:f[e++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};$jscomp.makeIterator=function(f){var e="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];if(e)return e.call(f);if("number"==typeof f.length)return $jscomp.arrayIterator(f);throw Error(String(f)+" is not an iterable or ArrayLike");};
$jscomp.arrayFromIterator=function(f){for(var e,l=[];!(e=f.next()).done;)l.push(e.value);return l};$jscomp.arrayFromIterable=function(f){return f instanceof Array?f:$jscomp.arrayFromIterator($jscomp.makeIterator(f))};$jscomp.getRestArguments=function(){for(var f=Number(this),e=[],l=f;l<arguments.length;l++)e[l-f]=arguments[l];return e};
(function(){var f,e,l;var k=this;var x=document.querySelector(".tmb-lightbox-wrapper");var y=x.querySelector(".tmb-lightbox-negative-space");var z=x.querySelector(".tmb-lightbox-close-btn");var E=x.querySelector(".tmb-lightbox-zoom-in-btn");var F=x.querySelector(".tmb-lightbox-zoom-out-btn");var O=x.querySelector(".tmb-lightbox-zoom-reset-btn");var G=x.querySelector(".tmb-lightbox-content");var X=function(b){b.preventDefault();(function(a){a&&a.classList.contains("show")&&(a.removeAttribute("tabindex"),
document.querySelectorAll(".tmb-lightbox-buttons a").forEach(function(c){c.setAttribute("tabindex","-1")}),a.classList.remove("show"),a.blur())})(document.querySelector(".tmb-lightbox-wrapper"));(function(a){a&&a.remove()})(document.querySelector(".cloned-image"));k.appendToCSS(":root","{ --cloned-image-scale: 1; }");k.appendToCSS(":root","{ --cloned-image-object-position: 50% 50%; }");document.querySelectorAll(":not(.tmb-lightbox-wrapper) [data-tmb-tabindex]").forEach(function(a){a.hasAttribute("data-tmb-tabindex")&&
(a.setAttribute("tabindex",a.getAttribute("data-tmb-tabindex")),a.removeAttribute("data-tmb-tabindex"))});document.querySelectorAll("a[data-tmb-tabbable-anchor]").forEach(function(a){""!==a.getAttribute("data-tmb-tabbable-anchor")?a.setAttribute("tabindex",a.getAttribute("data-tmb-tabbable-anchor")):a.removeAttribute("tabindex");a.removeAttribute("data-tmb-tabbable-anchor")});document.querySelectorAll("button[data-tmb-tabbable-button]").forEach(function(a){""!==a.getAttribute("data-tmb-tabbable-button")?
a.setAttribute("tabindex",a.getAttribute("data-tmb-tabbable-button")):a.removeAttribute("tabindex");a.removeAttribute("data-tmb-tabbable-button")});v();(function(a){if(a){var c;null==(c=a.closest(".tmb-lightbox-source"))||c.focus({preventScroll:!0});a.classList.remove("tmb-lightbox-current-source-img-element");delete a.dataset.selected}})(document.querySelector(".tmb-lightbox-current-source-img-element"))};var ia=function(b,a,c,h,r){return 0===a||0===h?!1:c/h>(b-r)/a?"width":"height"};var A=function(b,
a,c){var h=new IntersectionObserver(function(r){r.forEach(function(m){e[a]=m.boundingClientRect;null!==c&&c(b)});h.disconnect()});h.observe(b)};var ka=function(b){A(b,"originalImage",ja)};var ja=function(){var b=document.querySelector(".tmb-lightbox-content");b&&A(b,"lightboxContent",la)};var la=function(){var b=document.querySelector(".tmb-lightbox-buttons");b&&A(b,"lightboxButtons",ma)};var ma=function(b){(b=document.querySelector(".cloned-image"))&&A(b,"clonedImage",na)};var oa=function(){return 1===
g()?window.visualViewport.scale/g():Y()?1/g():Z()?1/g():window.visualViewport.scale/g()};var na=function(b){var a,c,h,r,m,n,u;var p=[];var w=-1;var pa=e.lightboxContent.height;var qa=e.lightboxContent.width;var H=e.originalImage.height;var I=e.originalImage.width;if(0===H||0===I)return console.log("Error: image with 0 for height or width"),!1;var P=e.clonedImage.height;var Q=e.clonedImage.width;var R=e.lightboxButtons.width;var J=ia(qa,pa,I,H,R);"height"===J?r=I*P/H:"width"===J?h=H*Q/I:console.log("Division by zero");
void 0===m&&(m=0);void 0===n&&(n=0);P=e.clonedImage.x;Q=e.clonedImage.y;var aa=P;var ba=Q;l=0;var ra=function(d){var q=p.findIndex(function(t){return t.pointerId===d.pointerId});-1!==q&&p.splice(q,1)};var D=function(d){var q,t,K,S,T,U;d.cancelable&&d.preventDefault();d.stopPropagation();u&&window.cancelAnimationFrame(u);var ca=function(){sa()&&("height"===J?(m=.5*(e.lightboxContent.width-R)-.5*r,n=0):(m=0,n=.5*e.lightboxContent.height-.5*h),B(!1));if(Y()||Z()){"height"===J?0===m&&(m=.5*(e.lightboxContent.width-
R)-.5*r):0===n&&(n=.5*e.lightboxContent.height+.5*h);if(1!==g())if(l<g())for(q=g(),t=l;q>=l+1;)t+=1,1!==t&&(m+=1/(t-1)*m,n+=1/(t-1)*n),--q;else for(t=g(),q=l;t<l;)--q,1!==q&&(m-=1/(q+1)*m,n-=1/(q+1)*n),t+=1;V(!1);W(!1)}T=d;a=m+(T.clientX-aa);c=n+(T.clientY-ba);a*=U;c*=U;k.appendToCSS(":root","{--cloned-image-object-position: "+a+"px "+c+"px; }");l=g()};var ta=function(){K=Math.sqrt(Math.pow(p[1].clientX-p[0].clientX,2)+Math.pow(p[1].clientY-p[0].clientY,2));0<w&&(K>w+3&&8>g()&&(L(1),k.appendToCSS(":root",
"{ --cloned-image-scale: "+g()+"; }"),v(),C(),M(d)),K<w-3&&1<g()&&(L(-1),k.appendToCSS(":root","{ --cloned-image-scale: "+g()+"; }"),v(),C(),1===g()&&(B(!0),k.appendToCSS(":root","{--cloned-image-object-position: center center; }"),l=0),M(d)));w=K};u=window.requestAnimationFrame(function(){if("touch"===d.pointerType||"pen"===d.pointerType||"mouse"===d.pointerType)U=oa(),S=p.findIndex(function(ua){return d.pointerId===ua.pointerId}),-1!==S&&(p[S]=d),"touch"===d.pointerType?2===p.length?ta():ca():ca()})};
var M=function(d){d.cancelable&&d.preventDefault();d.stopPropagation();if("touch"===d.pointerType||"pen"===d.pointerType||"mouse"===d.pointerType)ra(d),2>p.length&&(w=-1),u&&window.cancelAnimationFrame(u),V(!1),W(!1),d=window.visualViewport.scale/g(),b.removeEventListener("pointermove",D,{passive:!1}),b.removeEventListener("pointerup",D,{passive:!1}),m=a/d,n=c/d};var da=function(d){d.cancelable&&d.preventDefault();d.stopPropagation();p.push(d);if("touch"===d.pointerType||"pen"===d.pointerType||"mouse"===
d.pointerType)b.removeEventListener("pointermove",D,{passive:!1}),b.hasAttribute("data-draggable")&&(aa=d.clientX,ba=d.clientY,b.addEventListener("pointermove",D,{passive:!1}),b.addEventListener("pointerup",M,{passive:!1}))};b.addEventListener("pointerdown",da,{passive:!1});var N=function(){z.removeEventListener("click",N);y.removeEventListener("click",N);b.removeEventListener("pointerdown",da,{passive:!1});b.removeEventListener("pointermove",D,{passive:!1});b.removeEventListener("pointerup",M,{passive:!1})};
z.addEventListener("click",N);y.addEventListener("click",N)};var C=function(){var b=document.querySelector(".cloned-image");b&&(1<=g()?b.dataset.draggable="":delete b.dataset.draggable)};var L=function(b){var a=document.querySelector(".cloned-image");if(a){var c=parseInt(a.dataset.zoom,10);c+=b;c=1>c?1:8<c?8:c;a.dataset.zoom=c}return c};var g=function(){var b=document.querySelector(".cloned-image"),a;b&&(a=parseInt(b.dataset.zoom,10));return a};var B=function(b){var a=document.querySelector(".cloned-image");
a&&(!0===b?a.dataset.firstDrag="":delete a.dataset.firstDrag)};var sa=function(){var b=document.querySelector(".cloned-image"),a;b&&(a=b.hasAttribute("data-first-drag"));return a};var ea=function(b){if("fade"===b.animationName){var a=document.querySelector(".work-image .tmb-lightbox-source img[data-selected]");a&&(ka(a),(a=document.querySelector(".tmb-lightbox-wrapper"))&&a.focus());b.target.removeEventListener("animationend",ea)}};var va=function(){k.appendToCSS(":root","{ --document-scroll-height: "+
document.documentElement.scrollHeight+"px; }");(function(b){b&&(document.querySelectorAll(":not(.tmb-lightbox-wrapper) [tabindex]").forEach(function(a){a.setAttribute("data-tmb-tabindex",a.getAttribute("tabindex"));a.setAttribute("tabindex",-1)}),document.querySelectorAll(":not(.tmb-lightbox-wrapper) a").forEach(function(a){a.hasAttribute("tabindex")?a.setAttribute("data-tmb-tabbable-anchor",a.getAttribute("tabindex")):a.setAttribute("data-tmb-tabbable-anchor","");a.setAttribute("tabindex",-1)}),
document.querySelectorAll(":not(.tmb-lightbox-wrapper) button").forEach(function(a){a.hasAttribute("tabindex")?a.setAttribute("data-tmb-tabbable-button",a.getAttribute("tabindex")):a.setAttribute("data-tmb-tabbable-button","");a.setAttribute("tabindex",-1)}),b.setAttribute("tabindex","0"),document.querySelectorAll(".tmb-lightbox-buttons a").forEach(function(a){a.setAttribute("tabindex","0")}),b.addEventListener("animationend",ea),b.classList.add("show"))})(document.querySelector(".tmb-lightbox-wrapper"))};
var v=function(){var b=document.querySelector(".cloned-image");b&&(b=parseInt(b.dataset.zoom,10),E.disabled=8<=b?!0:!1,F.disabled=1>=b?!0:!1)};var Y=function(){return"true"===G.dataset.zoomInButton};var Z=function(){return"true"===G.dataset.zoomOutButton};var V=function(b){G.setAttribute("data-zoom-in-button",b)};var W=function(b){G.setAttribute("data-zoom-out-button",b)};var wa=function(b){b.preventDefault();8>g()&&(L(1),k.appendToCSS(":root","{ --cloned-image-scale: "+g()+"; }"),v(),C(),V(!0))};
var xa=function(b){b.preventDefault();1<g()&&(L(-1),k.appendToCSS(":root","{ --cloned-image-scale: "+g()+"; }"),v(),C(),1===g()&&(B(!0),k.appendToCSS(":root","{--cloned-image-object-position: center center; }"),l=0),W(!0))};var ya=function(b){b.preventDefault();k.appendToCSS(":root","{ --cloned-image-scale: 1; }");v();C();if(b=document.querySelector(".cloned-image"))b.dataset.zoom=1;B(!0);k.appendToCSS(":root","{--cloned-image-object-position: center center; }");l=0};var fa=function(b,a){a=void 0===
a?1E3:a;var c;return function(){var h=$jscomp.getRestArguments.apply(0,arguments);window.clearTimeout(c);c=window.setTimeout(function(){b.apply(null,$jscomp.arrayFromIterable(h))},a)}};var za=function(){var b=1/window.visualViewport.scale;var a=window.visualViewport.offsetLeft;var c=window.visualViewport.offsetTop;k.appendToCSS(":root","{--lightbox-scale: "+b+"; }");k.appendToCSS(":root","{--lightbox-top: "+c+"px; }");k.appendToCSS(":root","{--lightbox-left: "+a+"px; }")};var Aa=function(){(function(b){var a,
c,h;var r=function(m,n,u,p){var w=m*window.visualViewport.scale;n*=window.visualViewport.scale;return.5*(m-n)*u+p-.5*(w-n)*u};b&&A(b,"pzLightboxContent",function(){h=1/window.visualViewport.scale;a=r(window.innerWidth,e.pzLightboxContent.height,h,window.visualViewport.offsetLeft);c=r(window.innerHeight,e.pzLightboxContent.height,h,window.visualViewport.offsetTop);k.appendToCSS(":root","{--lightbox-scale: "+h+"; }");k.appendToCSS(":root","{--lightbox-left: "+a+"px; }");k.appendToCSS(":root","{--lightbox-top: "+
c+"px; }")})})(document.querySelector(".tmb-lightbox-content"))};var Ba=function(){E.classList.contains("lightbox-click-listener")||(E.classList.add("lightbox-click-listener"),E.addEventListener("click",wa));F.classList.contains("lightbox-click-listener")||(F.classList.add("lightbox-click-listener"),F.addEventListener("click",xa));O.classList.contains("lightbox-click-listener")||(O.classList.add("lightbox-click-listener"),O.addEventListener("click",ya));z.classList.contains("lightbox-click-listener")||
(z.classList.add("lightbox-click-listener"),z.addEventListener("click",X));y.classList.contains("lightbox-click-listener")||(y.classList.add("lightbox-click-listener"),y.addEventListener("click",X));var b=fa(Aa);var a=fa(za);a();window.visualViewport.removeEventListener("resize",a);window.removeEventListener("pointermove",b);window.removeEventListener("scroll",b);window.visualViewport.addEventListener("resize",a);window.addEventListener("pointermove",b);window.addEventListener("scroll",b)};var ha=
function(b){"fade-out"===b.animationName&&(k.appendToCSS(":root","{--lightbox-wrapper-visibility: visible; }"),b.target.removeEventListener("animationend",ha))};(function(){Ba();(function(b){function a(c){c=c.querySelector(".work-image .tmb-lightbox-source img");if(c){f=c.cloneNode(!1);var h=document.createDocumentFragment();h.appendChild(f);f.classList.add("cloned-image");f.dataset.draggable="";f.dataset.zoom=1;f.dataset.firstDrag="";b.appendChild(h);c.classList.add("tmb-lightbox-current-source-img-element");
c.dataset.selected="";va()}}b&&(e={},B(!0),v(),document.querySelectorAll(".tmb-lightbox-source").forEach(function(c){c.classList.contains("lightbox-click-listener")||(c.classList.add("lightbox-click-listener"),c.classList.add("initialized"),c.addEventListener("click",function(){a(c)}),c.addEventListener("keydown",function(h){"Enter"===h.key&&a(c)}))}),function(c){c&&!c.classList.contains("lightbox-wrapper-animation-end")&&(c.classList.add("lightbox-wrapper-animation-end"),c.addEventListener("animationend",
ha))}(document.querySelector(".tmb-lightbox-wrapper")))})(document.querySelector(".tmb-lightbox-viewer"))})()})();